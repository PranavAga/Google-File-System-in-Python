syntax = "proto3";

package gfs;

message Empty {}

message String {
  string st = 1;
}

message HeartbeatRequest {
  string chunkserver_id = 1;
  repeated string chunks = 2;
}

message HeartbeatResponse {
  bool success = 1;
  repeated string invalid_chunks = 2;
}

message ChunkData {
  string chunk_handle = 1;
  bytes data = 2;
  int64 version = 3;
}

service MasterServer {
  // Client to Master RPCs
  rpc ListFiles(String) returns (String);
  rpc CreateFile(String) returns (String);
  rpc AppendToFile(String) returns (String);
  rpc ReadFromFile(String) returns (String);
  rpc DeleteFile(String) returns (String);
  rpc UndeleteFile(String) returns (String);

  // Chunkserver to Master RPCs
  rpc Heartbeat(HeartbeatRequest) returns (HeartbeatResponse);
  rpc ReportChunk(String) returns (Empty);
}

service ChunkServer {
  // Client to Chunkserver RPCs
  rpc PushData(ChunkData) returns (String);
  rpc ReadData(String) returns (ChunkData);

  // Chunkserver to Chunkserver RPCs
  rpc ReplicateChunk(ChunkData) returns (String);
}